---
title: 智能体
description: Learn more about how to define agents in the OpenAI Agents SDK for JavaScript / TypeScript
---

import { Code } from '@astrojs/starlight/components';
import simpleAgent from '../../../../../../examples/docs/agents/simpleAgent.ts?raw';
import agentWithTools from '../../../../../../examples/docs/agents/agentWithTools.ts?raw';
import agentWithContext from '../../../../../../examples/docs/agents/agentWithContext.ts?raw';
import agentWithAodOutputType from '../../../../../../examples/docs/agents/agentWithAodOutputType.ts?raw';
import agentsAsTools from '../../../../../../examples/docs/agents/agentsAsTools.ts?raw';
import agentWithHandoffs from '../../../../../../examples/docs/agents/agentWithHandoffs.ts?raw';
import agentWithDynamicInstructions from '../../../../../../examples/docs/agents/agentWithDynamicInstructions.ts?raw';
import agentWithLifecycleHooks from '../../../../../../examples/docs/agents/agentWithLifecycleHooks.ts?raw';
import agentCloning from '../../../../../../examples/docs/agents/agentCloning.ts?raw';
import agentForcingToolUse from '../../../../../../examples/docs/agents/agentForcingToolUse.ts?raw';

智能体是 OpenAI Agents SDK 的主要构建块。**Agent** 是一种经过配置的 大语言模型（LLM），包含：

- **Instructions** —— 告诉模型“它是谁”和“应该如何回应”的系统提示（system prompt）。
- **Model** —— 要调用的 OpenAI 模型，以及可选的模型调优参数。
- **Tools** —— LLM 可调用以完成任务的函数或 API 列表。

<Code lang="typescript" code={simpleAgent} title="基础智能体定义" />

本页余下内容将更详细地介绍每个智能体功能。

---

## 智能体基础

### 基本配置

`Agent` 构造函数接收一个配置对象。最常用的属性如下所示。

| Property                          | Required | Description                                                                                                               |
| --------------------------------- | -------- | ------------------------------------------------------------------------------------------------------------------------- |
| `name`                            | yes      | 简短、便于阅读的标识符。                                                                                                  |
| `instructions`                    | yes      | 系统提示（字符串**或**函数——参见[动态 instructions](#dynamic-instructions)）。                                            |
| `prompt`                          | no       | OpenAI Responses API 的提示配置。参见[模型](/openai-agents-js/zh/guides/models#prompt)。                                  |
| `handoffDescription`              | no       | 当该智能体作为交接工具提供时使用的简短描述。                                                                              |
| `model`                           | no       | 模型名称**或**自定义的 [`Model`](/openai-agents-js/openai/agents/interfaces/model/) 实现。                                |
| `modelSettings`                   | no       | 调优参数（temperature、top_p 等）。如果所需属性不在顶层，可放在 `providerData` 下。                                       |
| `tools`                           | no       | 模型可调用的 [`Tool`](/openai-agents-js/openai/agents/type-aliases/tool/) 实例数组。                                      |
| `mcpServers`                      | no       | 向智能体提供工具的 MCP 服务器。参见 [MCP 指南](/openai-agents-js/zh/guides/mcp)。                                         |
| `resetToolChoice`                 | no       | 在一次工具调用后将 `toolChoice` 重置为默认值（默认：`true`），以防止工具使用循环。参见[强制使用工具](#forcing-tool-use)。 |
| `handoffOutputTypeWarningEnabled` | no       | 当交接的输出类型不一致时发出警告（默认：`true`）。                                                                        |

<Code lang="typescript" code={agentWithTools} title="带工具的智能体" />

---

### 上下文

智能体在其上下文类型上是泛型的——即 `Agent<TContext, TOutput>`。上下文是您创建并传递给 `Runner.run()` 的依赖注入对象。它会转发给每个工具、护栏、交接等，适用于存储状态或提供共享服务（数据库连接、用户元数据、功能开关等）。

<Code lang="typescript" code={agentWithContext} title="带上下文的智能体" />

---

### 输出类型

默认情况下，智能体返回**纯文本**（`string`）。如果希望模型返回结构化对象，可以指定 `outputType` 属性。SDK 接受：

1. [Zod](https://github.com/colinhacks/zod) 模式（`z.object({...})`）。
2. 任意兼容 JSON Schema 的对象。

<Code
  lang="typescript"
  code={agentWithAodOutputType}
  title="使用 Zod 的结构化输出"
/>

当提供 `outputType` 时，SDK 会自动使用
[structured outputs](https://platform.openai.com/docs/guides/structured-outputs)，而不是纯文本。

---

## 组合模式

### 多智能体系统设计模式

组合智能体的方法很多。在生产应用中，我们常见两种模式：

1. **Manager (Agents as tools)** —— 一个中心智能体掌控对话，并调用以工具形式暴露的专业化智能体。
2. **交接（Handoffs）** —— 初始智能体在识别出用户请求后，将整个对话委派给专家智能体。

这两种方式是互补的。Manager 为您提供集中施加护栏或速率限制的位置，而交接让每个智能体专注于单一任务而不必继续掌控对话。

#### Manager (Agents as tools)

在该模式中，manager 从不移交控制权——LLM 使用工具，manager 总结最终答案。详情参见[工具](/openai-agents-js/zh/guides/tools#agents-as-tools)。

<Code lang="typescript" code={agentsAsTools} title="Agents as tools" />

#### 交接（Handoffs）

使用交接时，分诊智能体负责路由请求，但一旦发生交接，专家智能体就拥有对话，直到产生最终输出。这使提示更短，并让您可以独立地推理每个智能体。更多信息参见[交接](/openai-agents-js/zh/guides/handoffs)。

<Code lang="typescript" code={agentWithHandoffs} title="带交接的智能体" />

---

## 高级配置与运行时控制

### 动态 instructions

`instructions` 可以是**函数**而非字符串。该函数接收当前的 `RunContext` 和智能体实例，并可返回字符串或 `Promise<string>`。

<Code
  lang="typescript"
  code={agentWithDynamicInstructions}
  title="带动态 instructions 的智能体"
/>

同时支持同步和 `async` 函数。

---

### 生命周期钩子

对于高级用例，您可以通过监听事件来观察智能体生命周期。可用事件名称请参阅[此处](https://github.com/openai/openai-agents-js/blob/main/packages/agents-core/src/lifecycle.ts)列出的智能体钩子事件。

<Code
  lang="typescript"
  code={agentWithLifecycleHooks}
  title="带生命周期钩子的智能体"
/>

---

### 护栏

护栏允许您验证或转换用户输入与智能体输出。可通过 `inputGuardrails` 和 `outputGuardrails` 数组进行配置。详情参见[护栏](/openai-agents-js/zh/guides/guardrails)指南。

---

### 克隆/复制智能体

需要现有智能体的轻微变体？使用 `clone()` 方法，它会返回一个全新的 `Agent` 实例。

<Code lang="typescript" code={agentCloning} title="克隆智能体" />

---

### 强制使用工具

提供工具并不保证 LLM 会调用。您可以通过 `modelSettings.toolChoice` 来**强制**使用工具：

1. `'auto'`（默认）—— 由 LLM 决定是否使用工具。
2. `'required'` —— LLM 必须调用一个工具（可自行选择哪个）。
3. `'none'` —— LLM 必须**不**调用工具。
4. 指定工具名，例如 `'calculator'` —— LLM 必须调用该特定工具。

<Code lang="typescript" code={agentForcingToolUse} title="强制使用工具" />

#### 防止无限循环

在一次工具调用后，SDK 会自动将 `toolChoice` 重置为 `'auto'`。这可防止模型反复尝试调用同一工具而陷入无限循环。您可以通过 `resetToolChoice` 标志覆盖此行为，或通过配置
`toolUseBehavior`：

- `'run_llm_again'`（默认）—— 使用工具结果再次运行 LLM。
- `'stop_on_first_tool'` —— 将第一个工具结果视为最终答案。
- `{ stopAtToolNames: ['my_tool'] }` —— 当调用任一列出的工具时停止。
- `(context, toolResults) => ...` —— 返回是否应结束运行的自定义函数。

```typescript
const agent = new Agent({
  ...,
  toolUseBehavior: 'stop_on_first_tool',
});
```

注意：`toolUseBehavior` 仅适用于**函数工具**。托管工具始终会返回模型进行处理。

---

## 后续步骤

- 了解如何[运行智能体](/openai-agents-js/zh/guides/running-agents)。
- 深入学习[工具](/openai-agents-js/zh/guides/tools)、[护栏](/openai-agents-js/zh/guides/guardrails)和[模型](/openai-agents-js/zh/guides/models)。
- 在侧边栏的 **@openai/agents** 下查看完整的 TypeDoc 参考。
