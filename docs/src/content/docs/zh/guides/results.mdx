---
title: 执行结果
description: Learn how to access the results and output from your agent run
---

import { Code } from '@astrojs/starlight/components';
import handoffFinalOutputTypes from '../../../../../../examples/docs/results/handoffFinalOutputTypes.ts?raw';
import historyLoop from '../../../../../../examples/docs/results/historyLoop.ts?raw';
import usageExample from '../../../../../../examples/docs/results/usage.ts?raw';

当您[运行智能体](/openai-agents-js/zh/guides/running-agents)时，您将收到以下之一：

- 如果调用 `run` 时未设置 `stream: true`，则为 [`RunResult`](/openai-agents-js/openai/agents/classes/runresult)
- 如果调用 `run` 时设置了 `stream: true`，则为 [`StreamedRunResult`](/openai-agents-js/openai/agents/classes/streamedrunresult)。有关流式传输的详细信息，请参阅[流式传输指南](/openai-agents-js/zh/guides/streaming)。

## 应使用哪个属性？

大多数应用只需要少量结果属性：

| 属性                        | 在您需要以下能力时使用…                                                |
| --------------------------- | ---------------------------------------------------------------------- |
| `finalOutput`               | 展示给用户的最终答案。                                                 |
| `history`                   | 用于手动聊天循环的完整下一轮输入数组（`input + generated items`）。    |
| `output`                    | 仅包含本次运行中生成的、符合模型输出形状的条目。                       |
| `newItems`                  | 包含智能体/工具元数据的丰富运行条目，可用于日志、UI 或审计。           |
| `lastAgent` / `activeAgent` | 通常应处理下一轮的智能体。                                             |
| `lastResponseId`            | 在下一次 OpenAI Responses 轮次中，使用 `previousResponseId` 进行续接。 |
| `interruptions`             | 在恢复前必须处理的待审批工具请求。                                     |
| `state`                     | 用于恢复/重试流程的可序列化快照。                                      |

## 最终输出

`finalOutput` 属性包含最后一个运行的智能体的最终输出。该结果可能是：

- `string` —— 对于未定义 `outputType` 的智能体，默认类型为此
- `unknown` —— 如果智能体将 JSON schema 定义为输出类型。在这种情况下 JSON 已被解析，但您仍需手动校验其类型。
- `z.infer<outputType>` —— 如果智能体将 Zod schema 定义为输出类型。输出将自动按该 schema 解析。
- `undefined` —— 如果智能体未产生输出（例如在产出前就停止）

如果您在交接中使用了不同的输出类型，应使用 `Agent.create()` 方法而不是 `new Agent()` 构造函数来创建智能体。

这样可让 SDK 推断所有可能交接路径上的输出类型，并为 `finalOutput` 属性提供联合类型。

例如：

<Code
  lang="typescript"
  code={handoffFinalOutputTypes}
  title="Handoff final output types"
/>

## 下一轮输入

您可以通过两种方式访问下一轮输入：

- `result.history` —— 包含您的输入和智能体输出的副本。
- `result.output` —— 包含完整智能体运行的输出。

在实践中：

- 当您在应用中手动维护完整会话时，使用 `result.history`。
- 当您已在其他地方存储了先前会话历史，只想获取本次运行的新
  输出条目时，使用 `result.output`。
- 如果您使用的是 `conversationId` 或 `previousResponseId`，通常不需要将这两者之一
  再传回 `run()`。相反，只传新的用户输入并复用服务器管理的 ID。

在类聊天场景中，`history` 是维护完整历史的便捷方式：

<Code lang="typescript" code={historyLoop} title="History loop" />

## 最后一个智能体

`lastAgent` 属性包含最后一个运行的智能体。根据您的应用场景，这通常对用户下一次输入时很有用。例如，如果您有一个前线分流智能体，会交接给特定语言智能体，您可以保存最后一个智能体，并在用户下次发送消息时复用它。

`activeAgent` 是同一值的别名。

在流式模式下，访问 `currentAgent` 属性也很有用，它映射到当前正在运行的智能体。

## 新条目

`newItems` 属性包含本次运行期间生成的新条目。这些条目是 [`RunItem`](/openai-agents-js/openai/agents/type-aliases/runitem)。运行条目封装了由 LLM 生成的原始条目。除了 LLM 的输出外，您还可以借此访问这些事件关联的是哪个智能体。

- [`RunMessageOutputItem`](/openai-agents-js/openai/agents/classes/runmessageoutputitem) 表示来自 LLM 的一条消息。原始条目是生成的消息。
- [`RunHandoffCallItem`](/openai-agents-js/openai/agents/classes/runhandoffcallitem) 表示 LLM 调用了交接工具。原始条目是来自 LLM 的工具调用条目。
- [`RunHandoffOutputItem`](/openai-agents-js/openai/agents/classes/runhandoffoutputitem) 表示发生了一次交接。原始条目是对交接工具调用的工具响应。您还可以从该条目访问源/目标智能体。
- [`RunToolCallItem`](/openai-agents-js/openai/agents/classes/runtoolcallitem) 表示 LLM 调用了某个工具。
- [`RunToolCallOutputItem`](/openai-agents-js/openai/agents/classes/runtoolcalloutputitem) 表示某个工具已被调用。原始条目是工具响应。您还可以从该条目访问工具输出。
- [`RunReasoningItem`](/openai-agents-js/openai/agents/classes/runreasoningitem) 表示来自 LLM 的推理条目。原始条目是生成的推理内容。
- [`RunToolApprovalItem`](/openai-agents-js/openai/agents/classes/runtoolapprovalitem) 表示 LLM 请求对工具调用进行审批。原始条目是来自 LLM 的工具调用条目。

## 状态

`state` 属性包含本次运行的状态。`result` 上附带的大多数内容都派生自 `state`，但 `state` 也支持序列化/反序列化；如果您需要[从错误中恢复](/openai-agents-js/zh/guides/running-agents#exceptions)或恢复已暂停的[人机协作](/openai-agents-js/zh/guides/human-in-the-loop)流程，也可以将其作为后续 `run()` 调用的输入。

## 中断

如果您在智能体中使用了 `needsApproval`，运行可能会暂停并暴露 `interruptions`。该数组包含在运行继续前需要决策的 `RunToolApprovalItem`。请通过 `result.state.approve(...)` / `result.state.reject(...)` 处理它们，然后使用同一个 state 再次调用 `run()`。端到端模式请参阅[人机协作指南](/openai-agents-js/zh/guides/human-in-the-loop)。

## 其他信息

### 原始响应

`rawResponses` 属性包含智能体运行期间由模型生成的原始 LLM 响应。

### 最后响应 ID

`lastResponseId` 属性包含智能体运行期间由模型生成的最后一个响应的 ID。在使用 OpenAI Responses API 链式调用时，下一轮会将该值作为 `previousResponseId` 传回。

### 护栏结果

`inputGuardrailResults` 和 `outputGuardrailResults` 属性包含护栏结果（如果有）。护栏结果有时包含您希望记录或存储的有用信息，因此我们将其提供给您。

工具护栏结果通过 `toolInputGuardrailResults` 和 `toolOutputGuardrailResults` 单独暴露。

### 用量

Token 用量聚合在 `result.state.usage` 中，它会跟踪本次运行的请求次数和 Token 总量。对于流式运行，这些数据会在响应到达时更新。

<Code lang="typescript" code={usageExample} title="Read usage from RunState" />

### 原始输入

`input` 属性包含您传给 run 方法的原始输入。大多数情况下您不需要它，但在需要时可用。
