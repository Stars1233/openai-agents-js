---
title: エージェントの実行結果
description: Learn how to access the results and output from your agent run
---

import { Code } from '@astrojs/starlight/components';
import handoffFinalOutputTypes from '../../../../../../examples/docs/results/handoffFinalOutputTypes.ts?raw';
import historyLoop from '../../../../../../examples/docs/results/historyLoop.ts?raw';
import usageExample from '../../../../../../examples/docs/results/usage.ts?raw';

[エージェントの実行](/openai-agents-js/ja/guides/running-agents) を行うと、次のいずれかを受け取ります。

- `stream: true` なしで `run` を呼び出した場合は [`RunResult`](/openai-agents-js/openai/agents/classes/runresult)
- `stream: true` 付きで `run` を呼び出した場合は [`StreamedRunResult`](/openai-agents-js/openai/agents/classes/streamedrunresult)。ストリーミングの詳細は [ストリーミング](/openai-agents-js/ja/guides/streaming) も確認してください

## 使用するプロパティ

ほとんどのアプリケーションでは、必要な実行結果のプロパティは一部だけです。

| Property                    | Use it when you need...                                                       |
| --------------------------- | ----------------------------------------------------------------------------- |
| `finalOutput`               | ユーザーに表示する最終回答                                                    |
| `history`                   | 手動のチャットループ向けの完全な次ターン入力配列（`input + generated items`） |
| `output`                    | この実行で生成された、モデル出力形式の項目のみ                                |
| `newItems`                  | ログ、UI、監査向けの、エージェント/ツールのメタデータ付きリッチ実行項目       |
| `lastAgent` / `activeAgent` | 通常、次ターンを処理すべきエージェント                                        |
| `lastResponseId`            | 次の OpenAI Responses ターンで `previousResponseId` による継続                |
| `interruptions`             | 再開前に解決が必要な、保留中のツール承認                                      |
| `state`                     | 再開/再試行フロー向けのシリアライズ可能なスナップショット                     |

## 最終出力

`finalOutput` プロパティには、最後に実行されたエージェントの最終出力が入ります。結果は次のいずれかです。

- `string` — `outputType` が定義されていないエージェントのデフォルト
- `unknown` — エージェントの出力型として JSON schema が定義されている場合。この場合 JSON は解析済みですが、型の検証は手動で行う必要があります
- `z.infer<outputType>` — エージェントの出力型として Zod schema が定義されている場合。出力はこの schema に対して自動で解析されます
- `undefined` — エージェントが出力を生成しなかった場合（例: 出力生成前に停止した場合）

異なる出力型のハンドオフを使う場合、エージェントの作成には `new Agent()` コンストラクターではなく `Agent.create()` メソッドを使う必要があります。

これにより SDK は、すべての可能なハンドオフにまたがる出力型を推論し、`finalOutput` プロパティにユニオン型を提供できます。

例:

<Code
  lang="typescript"
  code={handoffFinalOutputTypes}
  title="Handoff final output types"
/>

## 次ターン入力

次のターンの入力にアクセスする方法は 2 つあります。

- `result.history` — 入力とエージェントの出力の両方のコピーを含みます
- `result.output` — エージェント実行全体の出力を含みます

実運用では次のように使い分けます。

- アプリケーション側で会話全体を手動で保持する場合は `result.history` を使います
- 既存の会話履歴を他で保存しており、この実行での新しい出力項目だけ欲しい場合は `result.output` を使います
- `conversationId` または `previousResponseId` を使っている場合、通常はどちらも `run()` に戻しません。代わりに新しいユーザー入力のみを渡し、サーバー管理の ID を再利用します

`history` は、チャットライクなユースケースで完全な履歴を維持する便利な方法です。

<Code lang="typescript" code={historyLoop} title="History loop" />

## 最後のエージェント

`lastAgent` プロパティには最後に実行されたエージェントが入ります。アプリケーションによっては、これは次にユーザーが入力したときに有用です。たとえば、最前線のトリアージエージェントが言語別エージェントにハンドオフする構成では、最後のエージェントを保存して、次回ユーザーがメッセージしたときに再利用できます。

`activeAgent` は同じ値のエイリアスです。

ストリーミングモードでは、現在実行中のエージェントに対応する `currentAgent` プロパティも有用です。

## 新規項目

`newItems` プロパティには、実行中に生成された新規項目が入ります。項目は [`RunItem`](/openai-agents-js/openai/agents/type-aliases/runitem) です。実行項目は LLM が生成した元項目をラップします。これにより LLM の出力に加えて、これらのイベントがどのエージェントに関連しているかへアクセスできます。

- [`RunMessageOutputItem`](/openai-agents-js/openai/agents/classes/runmessageoutputitem) は LLM からのメッセージを示します。元項目は生成されたメッセージです
- [`RunHandoffCallItem`](/openai-agents-js/openai/agents/classes/runhandoffcallitem) は LLM がハンドオフツールを呼び出したことを示します。元項目は LLM からのツール呼び出し項目です
- [`RunHandoffOutputItem`](/openai-agents-js/openai/agents/classes/runhandoffoutputitem) はハンドオフが発生したことを示します。元項目はハンドオフツール呼び出しへのツール応答です。項目からソース/ターゲットのエージェントにもアクセスできます
- [`RunToolCallItem`](/openai-agents-js/openai/agents/classes/runtoolcallitem) は LLM がツールを呼び出したことを示します
- [`RunToolCallOutputItem`](/openai-agents-js/openai/agents/classes/runtoolcalloutputitem) はツールが呼び出されたことを示します。元項目はツール応答です。項目からツール出力にもアクセスできます
- [`RunReasoningItem`](/openai-agents-js/openai/agents/classes/runreasoningitem) は LLM からの reasoning 項目を示します。元項目は生成された reasoning です
- [`RunToolApprovalItem`](/openai-agents-js/openai/agents/classes/runtoolapprovalitem) は LLM がツール呼び出しの承認を要求したことを示します。元項目は LLM からのツール呼び出し項目です

## 状態

`state` プロパティには実行の状態が入ります。`result` に含まれる情報の大半は `state` から導出されますが、`state` はシリアライズ/デシリアライズも可能で、[エラーからの復旧](/openai-agents-js/ja/guides/running-agents#exceptions) や一時停止中の [人間の介入（HITL）](/openai-agents-js/ja/guides/human-in-the-loop) フローの再開が必要な場合に、後続の `run()` 呼び出しへの入力として使えます。

## 割り込み

エージェントで `needsApproval` を使っている場合、実行は一時停止し、`interruptions` が公開されることがあります。この配列には、実行継続前に判断が必要な `RunToolApprovalItem` が含まれます。`result.state.approve(...)` / `result.state.reject(...)` で解決し、その同じ state で再度 `run()` を呼び出してください。エンドツーエンドのパターンは [人間の介入（HITL）](/openai-agents-js/ja/guides/human-in-the-loop) を確認してください。

## その他情報

### 生レスポンス

`rawResponses` プロパティには、エージェント実行中にモデルが生成した生の LLM レスポンスが含まれます。

### 最後のレスポンス ID

`lastResponseId` プロパティには、エージェント実行中にモデルが生成した最後のレスポンスの ID が含まれます。これは OpenAI Responses API のチェーン利用時に、次ターンで `previousResponseId` として渡す値です。

### ガードレール結果

`inputGuardrailResults` と `outputGuardrailResults` プロパティには、存在する場合にガードレールの結果が含まれます。ガードレール結果にはログ記録や保存に有用な情報が含まれることがあるため、これらを利用できるようにしています。

ツールのガードレール結果は `toolInputGuardrailResults` と `toolOutputGuardrailResults` で個別に公開されます。

### 使用量

トークン使用量は `result.state.usage` に集約され、実行におけるリクエスト回数とトークン合計を追跡します。ストリーミング実行では、レスポンス到着に応じてこのデータが更新されます。

<Code lang="typescript" code={usageExample} title="Read usage from RunState" />

### 元の入力

`input` プロパティには、run メソッドに渡した元の入力が含まれます。ほとんどの場合これは不要ですが、必要な場合に利用できます。
