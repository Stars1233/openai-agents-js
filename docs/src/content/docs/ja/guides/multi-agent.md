---
title: エージェントオーケストレーション
description: Coordinate the flow between several agents
---

エージェントオーケストレーションとは、アプリ内でのエージェントの流れを指します。どのエージェントが、どの順序で実行され、次に何が起こるかをどのように決定するか、ということです。エージェントをオーケストレーションする方法は主に 2 つあります。

1. LLM に意思決定を任せる: LLM の知性を使って、計画・推論し、それに基づいて実行すべきステップを決定します
2. コードでオーケストレーションする: コードによってエージェントの流れを決定します

これらのパターンは組み合わせて使えます。それぞれに独自のトレードオフがあり、以下で説明します。

## LLM によるオーケストレーション

エージェントは、instructions、ツール、ハンドオフを備えた LLM です。これは、オープンエンドなタスクが与えられたときに、LLM が自律的にタスクへの取り組み方を計画できることを意味します。ツールを使ってアクションを実行しデータを取得し、ハンドオフを使ってサブエージェントにタスクを委譲できます。たとえば、リサーチエージェントには次のようなツールを持たせることができます。

- オンライン情報を見つけるための Web 検索
- 独自データや接続先を検索するためのファイル検索と取得
- コンピュータ上で操作を実行するためのコンピュータ操作
- データ分析を行うためのコード実行
- 計画、レポート作成などを得意とする特化エージェントへのハンドオフ

### SDK の主要パターン

Agents SDK では、次の 2 つのオーケストレーションパターンが特によく使われます。

| パターン        | 仕組み                                                                                                                                       | 最適なケース                                                                                                                                           |
| --------------- | -------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| Agents as tools | マネージャーエージェントが会話の制御を維持し、`agent.asTool()` を通じて専門エージェントを呼び出します。                                      | 1 つのエージェントに最終回答を担わせたい場合、複数の専門エージェントの出力を統合したい場合、または共通ガードレールを 1 か所で強制したい場合            |
| ハンドオフ      | トリアージエージェントが会話を専門エージェントへルーティングし、その専門エージェントがそのターンの残りでアクティブなエージェントになります。 | 専門エージェントにユーザーへ直接応答させたい場合、プロンプトを絞り込みたい場合、または専門エージェントごとに異なる instructions / モデルを使いたい場合 |

専門エージェントにはサブタスクだけを手伝わせ、ユーザー向け会話を引き継がせたくない場合は、 **agents as tools** を使います。どのツールを呼び出すか、最終応答をどう提示するかの責任はマネージャーが持ち続けます。 API の詳細は [ツールガイド](/openai-agents-js/ja/guides/tools#agents-as-tools) を、比較例は [エージェントガイド](/openai-agents-js/ja/guides/agents#composition-patterns) を参照してください。

ワークフローの一部としてルーティング自体が重要で、選ばれた専門エージェントに会話の次の部分を担当させたい場合は、 **ハンドオフ** を使います。ハンドオフは会話コンテキストを維持しつつ、アクティブな instructions を専門エージェント向けに絞り込みます。 API は [ハンドオフガイド](/openai-agents-js/ja/guides/handoffs) を、最小のエンドツーエンド例は [クイックスタート](/openai-agents-js/ja/guides/quickstart#define-your-handoffs) を参照してください。

この 2 つのパターンは組み合わせ可能です。トリアージエージェントが専門エージェントへハンドオフし、その専門エージェントがさらに他のエージェントをツールとして使って、範囲の明確なサブタスクを処理することもできます。

このパターンは、タスクがオープンエンドで LLM の知性に依存したい場合に最適です。特に重要な戦術は次のとおりです。

1. 良いプロンプトに投資する。利用可能なツール、使い方、従うべきパラメーター制約を明確にします
2. アプリを監視して反復改善する。問題が起きる箇所を把握し、プロンプトを改善します
3. エージェントに内省と改善を許可する。たとえばループ実行して自己批評させる、またはエラーメッセージを与えて改善させます
4. 何でもこなす汎用エージェント 1 つに期待するのではなく、1 つのタスクに特化したエージェントを用意します
5. [evals](https://platform.openai.com/docs/guides/evals) に投資する。これによりエージェントを改善し、タスク性能を高められます

このスタイルのオーケストレーションを支える SDK の基本コンポーネントを使いたい場合は、[ツール](/openai-agents-js/ja/guides/tools)、[ハンドオフ](/openai-agents-js/ja/guides/handoffs)、[エージェントの実行](/openai-agents-js/ja/guides/running-agents) から始めてください。

## コードによるオーケストレーション

LLM によるオーケストレーションは強力ですが、コードによるオーケストレーションは、速度・コスト・パフォーマンスの面でタスクをより決定論的かつ予測可能にできます。よくあるパターンは次のとおりです。

- [structured outputs](https://platform.openai.com/docs/guides/structured-outputs) を使って、コードで検査できる適切な形式のデータを生成する。たとえば、タスクをいくつかのカテゴリーに分類させ、カテゴリーに応じて次のエージェントを選ぶことができます
- 複数エージェントを連鎖させ、前段の出力を次段の入力に変換する。ブログ記事作成のようなタスクを、リサーチ、アウトライン作成、記事執筆、批評、改善のステップに分解できます
- タスク実行エージェントを、評価とフィードバックを行うエージェントとともに `while` ループで実行し、評価側が出力が基準を満たしたと判定するまで繰り返す
- 複数エージェントを並列実行する。たとえば `Promise.all` のような JavaScript の基本機能を使います。これは、相互依存しない複数タスクがある場合の高速化に有効です

[`examples/agent-patterns`](https://github.com/openai/openai-agents-js/tree/main/examples/agent-patterns) に多数のコード例があります。

## 関連ガイド

- 合成パターンとエージェント設定については [エージェント](/openai-agents-js/ja/guides/agents)
- `agent.asTool()` とマネージャースタイルのオーケストレーションについては [ツール](/openai-agents-js/ja/guides/tools#agents-as-tools)
- 専門エージェント間の委譲については [ハンドオフ](/openai-agents-js/ja/guides/handoffs)
- `Runner` と実行単位のオーケストレーション制御については [エージェントの実行](/openai-agents-js/ja/guides/running-agents)
- 最小のエンドツーエンドなハンドオフ例については [クイックスタート](/openai-agents-js/ja/guides/quickstart)
