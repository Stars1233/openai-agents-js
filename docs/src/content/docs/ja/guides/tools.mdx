---
title: ツール
description: Provide your agents with capabilities via hosted tools or custom function tools
---

import { Code } from '@astrojs/starlight/components';
import toolsFunctionExample from '../../../../../../examples/docs/tools/functionTools.ts?raw';
import toolsHostedToolsExample from '../../../../../../examples/docs/tools/hostedTools.ts?raw';
import localBuiltInToolsExample from '../../../../../../examples/docs/tools/localBuiltInTools.ts?raw';
import nonStrictSchemaTools from '../../../../../../examples/docs/tools/nonStrictSchemaTools.ts?raw';
import agentsAsToolsExample from '../../../../../../examples/docs/tools/agentsAsTools.ts?raw';
import agentsAsToolsStreamingExample from '../../../../../../examples/docs/tools/agentsAsToolsStreaming.ts?raw';
import mcpLocalServer from '../../../../../../examples/docs/tools/mcpLocalServer.ts?raw';
import codexToolExample from '../../../../../../examples/docs/tools/codexTool.ts?raw';
import codexRunContextThreadExample from '../../../../../../examples/docs/tools/codexRunContextThread.ts?raw';

ツールを使うと、Agent は **アクションの実行** ができます。データの取得、外部 API の呼び出し、コードの実行、さらにはコンピュータの使用まで可能です。JavaScript / TypeScript SDK は 6 つのカテゴリーをサポートしています。

1. **OpenAI がホストするツール** – OpenAI サーバー上でモデルと並行して実行されます。_(Web 検索、ファイル検索、Code Interpreter、画像生成)_
2. **組み込み実行ツール** – モデルの外側で実行される、SDK 提供のツールです。_(computer use と apply_patch はローカルで実行、shell はローカルまたはホストコンテナで実行可能)_
3. **関数ツール** – 任意のローカル関数を JSON schema でラップし、LLM が呼び出せるようにします。
4. **Agents as tools** – エージェント全体を呼び出し可能なツールとして公開します。
5. **MCP サーバー** – Model Context Protocol サーバー（ローカルまたはリモート）を接続します。
6. **実験的: Codex ツール** – Codex SDK を関数ツールとしてラップし、ワークスペースを認識したタスクを実行します。

---

## ツールのカテゴリー

このガイドの残りでは、まず各ツールカテゴリーを説明し、その後にツール選択とプロンプト設計に関する横断的なガイダンスを要約します。

### 1. 組み込みツール（OpenAI Responses API）

`OpenAIResponsesModel` を使用する場合、次の組み込みツールを追加できます。

| ツール           | Type string          | 用途                                                |
| ---------------- | -------------------- | --------------------------------------------------- |
| Web 検索         | `'web_search'`       | インターネット検索                                  |
| ファイル / 検索  | `'file_search'`      | OpenAI 上でホストされたベクトルストアへの問い合わせ |
| Code Interpreter | `'code_interpreter'` | サンドボックス環境でコードを実行                    |
| 画像生成         | `'image_generation'` | テキストに基づく画像生成                            |

<Code lang="typescript" code={toolsHostedToolsExample} title="Hosted tools" />

SDK は、ホストツール定義を返すヘルパー関数を提供しています。

| ヘルパー関数                    | 備考                                                                                                                                                                  |
| ------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `webSearchTool(options?)`       | `searchContextSize`、`userLocation`、`filters.allowedDomains` などの JS 向けオプション                                                                                |
| `fileSearchTool(ids, options?)` | 第 1 引数で 1 つ以上の ベクトルストア ID を受け取り、`maxNumResults`、`includeSearchResults`、`rankingOptions`、filters などのオプションも指定可能                    |
| `codeInterpreterTool(options?)` | `container` 未指定時は自動管理コンテナがデフォルト                                                                                                                    |
| `imageGenerationTool(options?)` | `model`、`size`、`quality`、`background`、`inputFidelity`、`inputImageMask`、`moderation`、`outputCompression`、`partialImages`、出力形式などの画像生成設定をサポート |

これらのヘルパーは、JavaScript / TypeScript 向けのオプション名を、基盤となる OpenAI Responses API のツールペイロードにマッピングします。完全なツールスキーマや、ranking options や semantic filters のような高度なオプションについては、公式の OpenAI ドキュメントを参照してください。

---

### 2. 組み込み実行ツール

これらのツールは SDK に組み込まれていますが、実行自体はモデル応答の外側で行われます。

- **コンピュータ操作** – `Computer` インターフェースを実装し、`computerTool()` に渡します。これは常に、あなたが提供するローカルの `Computer` 実装に対して実行されます
- **Shell** – ローカル `Shell` 実装を渡すか、`shellTool({ environment })` でホストコンテナ環境を設定します
- **Apply patch** – `Editor` インターフェースを実装し、`applyPatchTool()` に渡します。これは常に、あなたが提供するローカルの `Editor` 実装に対して実行されます

ツール呼び出し自体は引き続きモデルによって要求されますが、実作業はアプリケーションまたは設定済みの実行環境が行います。

<Code
  lang="typescript"
  code={localBuiltInToolsExample}
  title="Built-in execution tools"
/>

#### Computer ツールの詳細

`computerTool()` は次のいずれかを受け取ります。

- 具体的な `Computer` インスタンス
- 実行ごとに `Computer` を作成する初期化関数
- 実行スコープのセットアップ / クリーンアップが必要な場合の `{ create, dispose }` を持つプロバイダーオブジェクト

コンピュータ操作をユーザー確認のために一時停止したい場合は `needsApproval` を使用し、操作中に発生した保留中の safety check を承認または拒否したい場合は `onSafetyCheck` を使用します。

#### Shell ツールの詳細

`shellTool()` には 2 つのモードがあります。

- ローカルモード: `shell` を提供し、必要に応じて `environment: { type: 'local', skills }` と、承認自動処理のための `needsApproval` / `onApproval` を指定
- ホストコンテナモード: `type: 'container_auto'` または `type: 'container_reference'` を持つ `environment` を指定

ローカルモードでは、`environment.skills` により `name`、`description`、ファイルシステム `path` でローカルスキルをマウントできます。

ホストコンテナモードでは、`shellTool({ environment })` を次のいずれかで設定します。

- `type: 'container_auto'` で実行用の管理コンテナを作成
- `type: 'container_reference'` で `containerId` により既存コンテナを再利用

ホスト `container_auto` 環境は次をサポートします。

- `domainSecrets` を含む許可リストを含めた `networkPolicy`
- アップロード済みファイルをマウントするための `fileIds`
- コンテナサイズ調整のための `memoryLimit`
- `skill_reference` またはインライン zip バンドルによる `skills`

ホスト shell 環境では、実行がローカルプロセスではなくホストコンテナ環境で行われるため、`shell`、`needsApproval`、`onApproval` は受け付けません。

エンドツーエンドの使用例は `examples/tools/local-shell.ts`、`examples/tools/container-shell-skill-ref.ts`、`examples/tools/container-shell-inline-skill.ts` を参照してください。

#### Apply-patch ツールの詳細

`applyPatchTool()` は `shellTool()` のローカル承認フローを踏襲します。ファイル編集前に一時停止するには `needsApproval` を使用し、アプリレベルのコールバックで自動承認 / 拒否したい場合は `onApproval` を使用します。

---

### 3. 関数ツール

`tool()` ヘルパーを使えば、**任意** の関数をツール化できます。

<Code
  lang="typescript"
  code={toolsFunctionExample}
  title="Function tool with Zod parameters"
/>

#### オプションリファレンス

| フィールド             | 必須   | 説明                                                                                                                                                                                                                                                     |
| ---------------------- | ------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `name`                 | いいえ | 関数名（例: `get_weather`）がデフォルトになります                                                                                                                                                                                                        |
| `description`          | はい   | LLM に表示される、明確で人間が読める説明                                                                                                                                                                                                                 |
| `parameters`           | はい   | Zod スキーマまたは生の JSON schema オブジェクト。Zod パラメーターは自動的に **strict** モードを有効化します                                                                                                                                              |
| `strict`               | いいえ | `true`（デフォルト）の場合、引数の検証に失敗すると SDK はモデルエラーを返します。あいまい一致を許容する場合は `false` にします                                                                                                                           |
| `execute`              | はい   | `(args, context, details) => string \| unknown \| Promise<...>` – ビジネスロジック。文字列以外の出力はモデル向けにシリアライズされます。`context` は任意の `RunContext`、`details` には `toolCall`、`resumeState`、`signal` などのメタデータが含まれます |
| `errorFunction`        | いいえ | 内部エラーをユーザー表示文字列に変換するカスタムハンドラー `(context, error) => string`                                                                                                                                                                  |
| `timeoutMs`            | いいえ | 呼び出しごとのタイムアウト（ミリ秒）。0 より大きく `2147483647` 以下である必要があります                                                                                                                                                                 |
| `timeoutBehavior`      | いいえ | タイムアウトモード: `error_as_result`（デフォルト）はモデル可視のタイムアウトメッセージを返し、`raise_exception` は `ToolTimeoutError` を投げます                                                                                                        |
| `timeoutErrorFunction` | いいえ | `timeoutBehavior` が `error_as_result` のときのタイムアウト出力をカスタマイズするハンドラー `(context, timeoutError) => string`                                                                                                                          |
| `needsApproval`        | いいえ | 実行前に人間の承認を必須化します。[人間の介入（HITL）ガイド](/openai-agents-js/ja/guides/human-in-the-loop) を参照                                                                                                                                       |
| `isEnabled`            | いいえ | 実行ごとにツール公開可否を条件付けます。boolean または述語を受け取ります                                                                                                                                                                                 |
| `inputGuardrails`      | いいえ | ツール実行前に走るガードレール。reject または throw できます。[ガードレール](/openai-agents-js/ja/guides/guardrails#tool-guardrails) を参照                                                                                                              |
| `outputGuardrails`     | いいえ | ツール実行後に走るガードレール。reject または throw できます。[ガードレール](/openai-agents-js/ja/guides/guardrails#tool-guardrails) を参照                                                                                                              |

#### 関数ツールのタイムアウト

各関数ツール呼び出しの上限時間を設定するには `timeoutMs` を使用します。

- `timeoutBehavior: 'error_as_result'`（デフォルト）は `Tool '<name>' timed out after <timeoutMs>ms.` をモデルに返します
- `timeoutBehavior: 'raise_exception'` は [`ToolTimeoutError`](/openai-agents-js/openai/agents-core/classes/tooltimeouterror) を投げ、[エージェントの実行](/openai-agents-js/ja/guides/running-agents#exceptions) の例外処理として捕捉できます
- `timeoutErrorFunction` で `error_as_result` モード時のタイムアウト文言をカスタマイズできます
- タイムアウト時は `details.signal` が中断されるため、キャンセルを監視する長時間ツールは速やかに停止できます

関数ツールを直接呼び出す場合は、通常のエージェント実行と同じタイムアウト挙動を強制するために [`invokeFunctionTool`](/openai-agents-js/openai/agents/functions/invokefunctiontool) を使用してください。

#### 非 strict JSON-schema ツール

不正または部分的な入力をモデルに _推測_ させたい場合は、生の JSON schema 使用時に strict モードを無効化できます。

<Code
  lang="typescript"
  code={nonStrictSchemaTools}
  title="Non-strict JSON schema tools"
/>

---

### 4. Agents as tools

会話を完全にハンドオフせずに、ある Agent に別の Agent を _補助_ させたい場合があります。その場合は `agent.asTool()` を使います。

<Code lang="typescript" code={agentsAsToolsExample} title="Agents as tools" />

内部的に SDK は次を行います。

- 単一の `input` パラメーターを持つ関数ツールを作成
- ツール呼び出し時に、その入力でサブエージェントを実行
- 最後のメッセージ、または `customOutputExtractor` で抽出された出力を返却

エージェントをツールとして実行すると、Agents SDK はデフォルト設定でランナーを作成し、関数実行内でそのランナーによりエージェントを実行します。`runConfig` や `runOptions` のプロパティを指定したい場合は、`asTool()` メソッドに渡してランナー挙動をカスタマイズできます。

`asTool()` オプション経由でエージェントツールに `needsApproval` と `isEnabled` も設定できるため、Human in the loop (人間の介入) フローや条件付きツール公開と統合できます。

`agent.asTool()` の高度な構造化入力オプション:

- `inputBuilder`: 構造化ツール引数をネストされたエージェント入力ペイロードにマッピング
- `includeInputSchema`: より強いスキーマ認識挙動のため、ネスト実行に入力 JSON schema を含める
- `resumeState`: ネストされたシリアライズ済み `RunState` 再開時のコンテキスト調停戦略を制御。`'merge'`（デフォルト）は live な承認 / コンテキスト状態をシリアライズ状態へマージ、`'replace'` は代わりに現在の実行コンテキストを使用、`'preferSerialized'` はシリアライズ済みコンテキストを変更せず再開

#### エージェントツールからのストリーミングイベント

エージェントツールは、ネストされた実行イベントをすべてアプリへストリーミングできます。ツールの構築方法に合うフック形式を選んでください。

<Code
  lang="typescript"
  code={agentsAsToolsStreamingExample}
  title="Streaming agent tools"
/>

- イベント種別は `RunStreamEvent['type']` に一致します: `raw_model_stream_event`、`run_item_stream_event`、`agent_updated_stream_event`
- `onStream` は最もシンプルな「キャッチオール」で、ツールをインライン宣言する場合（`tools: [agent.asTool({ onStream })]`）に適しています。イベント単位のルーティングが不要ならこれを使います
- `on(eventName, handler)` は選択的（または `'*'`）に購読でき、より細かな処理や作成後のリスナー追加が必要な場合に適しています
- `onStream` またはいずれかの `on(...)` ハンドラーを指定すると、agent-as-tool は自動的にストリーミングモードで実行されます。指定しなければ非ストリーミング経路のままです
- ハンドラーは並列に呼び出されるため、遅い `onStream` コールバックが `on(...)` ハンドラーをブロックすることはありません（逆も同様）
- `toolCallId` はモデルのツール呼び出し経由で起動された場合に提供されます。直接 `invoke()` 呼び出しやプロバイダー側の事情で省略されることがあります

---

### 5. MCP サーバー

[Model Context Protocol (MCP)](https://modelcontextprotocol.io/) サーバー経由でツールを公開し、エージェントに接続できます。
たとえば `MCPServerStdio` を使うと、stdio MCP サーバーを起動して接続できます。

<Code lang="typescript" code={mcpLocalServer} title="Local MCP server" />

完全な例は [`filesystem-example.ts`](https://github.com/openai/openai-agents-js/tree/main/examples/mcp/filesystem-example.ts) を参照してください。また、MCP サーバーツール統合の包括的なガイドを探している場合は、詳細を [MCP 連携](/openai-agents-js/ja/guides/mcp) で確認してください。
複数サーバー（または部分的障害）を管理する場合は、`connectMcpServers` と [MCP 連携](/openai-agents-js/ja/guides/mcp#managing-mcp-server-lifecycle) のライフサイクルガイダンスを使用してください。

---

### 6. 実験的: Codex ツール

`@openai/agents-extensions/experimental/codex` は `codexTool()` を提供します。これは、モデルのツール呼び出しを Codex SDK にルーティングする関数ツールで、エージェントがワークスペーススコープのタスク（shell、ファイル編集、MCP ツール）を自律実行できるようにします。この機能は実験的であり、変更される可能性があります。

まず依存関係をインストールします。

```bash
npm install @openai/agents-extensions @openai/codex-sdk
```

クイックスタート:

<Code
  lang="typescript"
  code={codexToolExample}
  title="Experimental Codex tool"
/>

知っておくべき点:

- Auth: `CODEX_API_KEY`（推奨）または `OPENAI_API_KEY` を指定するか、`codexOptions.apiKey` を渡します
- Inputs: strict schema。`inputs` には少なくとも 1 つの `{ type: 'text', text }` または `{ type: 'local_image', path }` を含める必要があります
- Safety: `sandboxMode` と `workingDirectory` を組み合わせて使用します。ディレクトリが Git リポジトリでない場合は `skipGitRepoCheck` を設定します
- Threading: `useRunContextThreadId: true` は最新の thread id を `runContext.context` で読み書きします。アプリ状態でのターン間再利用に有用です
- Thread ID の優先順位: ツール呼び出し `threadId`（スキーマに含める場合）が最優先、次に run-context thread id、最後に `codexTool({ threadId })`
- Run context key: `name: 'codex'` の場合はデフォルトで `codexThreadId`、`name: 'engineer'` のような名前の場合は `codexThreadId_<suffix>`（正規化後は `codex_engineer`）
- 可変コンテキスト要件: `useRunContextThreadId` 有効時は、`run(..., { context })` に可変オブジェクトまたは `Map` を渡してください
- Naming: ツール名は `codex` 名前空間へ正規化されます（`engineer` は `codex_engineer`）。エージェント内の重複する Codex ツール名は拒否されます
- Streaming: `onStream` は Codex イベント（reasoning、コマンド実行、MCP ツール呼び出し、ファイル変更、Web 検索）を反映するため、進行状況のログやトレースに使えます
- Outputs: ツール結果には `response`、`usage`、`threadId` が含まれ、Codex のトークン使用量は `RunContext` に記録されます
- Structure: `outputSchema` には descriptor、JSON schema オブジェクト、または Zod オブジェクトを使用できます。JSON object schema では `additionalProperties` は `false` である必要があります

run-context thread 再利用の例:

<Code
  lang="typescript"
  code={codexRunContextThreadExample}
  title="Codex run-context thread reuse"
/>

---

## ツール戦略とベストプラクティス

### ツール使用挙動

モデルがいつ・どのようにツールを使うべきかの制御は、[エージェント](/openai-agents-js/ja/guides/agents#forcing-tool-use) を参照してください（`modelSettings.toolChoice`、`toolUseBehavior` など）。

---

### ベストプラクティス

- **短く明示的な説明** – ツールが _何をするか_ と _いつ使うか_ を記述する
- **入力の検証** – 可能な限り Zod スキーマを使って厳密な JSON 検証を行う
- **エラーハンドラーで副作用を避ける** – `errorFunction` は throw せず、有用な文字列を返す
- **ツールは 1 つの責務ごと** – 小さく合成可能なツールほどモデル推論が向上する

---

## 次のステップ

- [ツール使用の強制](/openai-agents-js/ja/guides/agents#forcing-tool-use) を学ぶ
- ツール入力 / 出力を検証する [ガードレール](/openai-agents-js/ja/guides/guardrails) を追加する
- [`tool()`](/openai-agents-js/openai/agents/functions/tool) と各種ホストツール型の TypeDoc リファレンスを確認する
