---
title: ツール
description: Provide your agents with capabilities via hosted tools or custom function tools
---

import { Code } from '@astrojs/starlight/components';
import toolsFunctionExample from '../../../../../../examples/docs/tools/functionTools.ts?raw';
import toolsHostedToolsExample from '../../../../../../examples/docs/tools/hostedTools.ts?raw';
import localBuiltInToolsExample from '../../../../../../examples/docs/tools/localBuiltInTools.ts?raw';
import nonStrictSchemaTools from '../../../../../../examples/docs/tools/nonStrictSchemaTools.ts?raw';
import agentsAsToolsExample from '../../../../../../examples/docs/tools/agentsAsTools.ts?raw';
import agentsAsToolsStreamingExample from '../../../../../../examples/docs/tools/agentsAsToolsStreaming.ts?raw';
import mcpLocalServer from '../../../../../../examples/docs/tools/mcpLocalServer.ts?raw';
import codexToolExample from '../../../../../../examples/docs/tools/codexTool.ts?raw';
import codexRunContextThreadExample from '../../../../../../examples/docs/tools/codexRunContextThread.ts?raw';

ツールはエージェントに**アクションを実行**させます。データ取得、外部 API 呼び出し、コード実行、さらにはコンピュータの使用まで可能です。JavaScript/TypeScript SDK は次の 6 つのカテゴリーをサポートします:

1. **OpenAI がホストするツール** – モデルと同じ OpenAI のサーバー上で実行されます。_(Web 検索、ファイル検索、Code Interpreter、画像生成)_
2. **ローカル組み込みツール** – あなたの環境で実行されます。_(コンピュータ操作、shell、apply_patch)_
3. **関数ツール** – 任意のローカル関数を JSON スキーマでラップして LLM から呼び出せるようにします.
4. **Agents as tools** – エージェント全体を呼び出し可能なツールとして公開します。
5. **MCP サーバー** – Model Context Protocol のサーバー（ローカルまたはリモート）を接続します。
6. **実験的: Codex ツール** – Codex SDK を関数ツールとしてラップし、ワークスペース対応のタスクを実行します。

---

## ツールのカテゴリー

このガイドの残りでは、まず各ツールのカテゴリーを説明し、その後に横断的なツール選定とプロンプト作成の指針をまとめます。

### 1. Hosted tools (OpenAI Responses API)

`OpenAIResponsesModel` を使うと、次の組み込みツールを追加できます:

| Tool                    | Type string          | Purpose                                     |
| ----------------------- | -------------------- | ------------------------------------------- |
| Web search              | `'web_search'`       | インターネット検索                          |
| File / retrieval search | `'file_search'`      | OpenAI 上でホストされるベクトルストアの検索 |
| Code Interpreter        | `'code_interpreter'` | サンドボックス環境でコードを実行            |
| Image generation        | `'image_generation'` | テキストに基づく画像生成                    |

<Code lang="typescript" code={toolsHostedToolsExample} title="Hosted tools" />

SDK は、ホスト型ツール定義を返すヘルパー関数を提供します:

| Helper function                 | Notes                                                                                                  |
| ------------------------------- | ------------------------------------------------------------------------------------------------------ |
| `webSearchTool(options?)`       | `searchContextSize`、`userLocation`、`filters.allowedDomains` などの JS に優しいオプションをサポート   |
| `fileSearchTool(ids, options?)` | 最初の引数に 1 つ以上のベクトルストア ID を取り、`maxNumResults` や filters などのオプションを指定可能 |
| `codeInterpreterTool(options?)` | `container` がない場合は自動管理コンテナがデフォルト                                                   |
| `imageGenerationTool(options?)` | `size`、`quality`、`background`、出力フォーマットなどの画像生成設定をサポート                          |

これらのヘルパーは、JavaScript/TypeScript に適したオプション名を OpenAI Responses API のツールペイロードにマッピングします。完全なツールスキーマや、ランキングオプション、セマンティックフィルタなどの高度なオプションは OpenAI 公式ドキュメントを参照してください。

---

### 2. ローカル組み込みツール

ローカル組み込みツールはあなたの環境で実行され、実装の提供が必要です:

- **コンピュータ操作** – `Computer` インターフェースを実装し、`computerTool()` に渡します
- **Shell** – ローカルの `Shell` 実装を提供するか、ホスト型コンテナ環境を構成します
- **Apply patch** – `Editor` インターフェースを実装し、`applyPatchTool()` に渡します

Computer と apply‑patch ツールはローカルで実行され、OpenAI によっては**ホストされません**。Shell ツールは、`shellTool()` の構成に応じてローカルまたはホスト型コンテナ環境で実行できます。
ツール呼び出しは引き続きモデルのレスポンスによって要求されますが、実際の実行方法はアプリケーションが制御します。

<Code
  lang="typescript"
  code={localBuiltInToolsExample}
  title="Local built-in tools"
/>

ホスト型の shell 環境の場合、`shellTool({ environment })` を次のいずれかで構成します:

- `type: 'container_auto'` 実行ごとに管理コンテナを作成（ネットワークポリシー、メモリ上限、skills をサポート）
- `type: 'container_reference'` 既存のコンテナを `containerId` で再利用

エンドツーエンドの使用法は `examples/tools/container-shell-skill-ref.ts` と `examples/tools/container-shell-inline-skill.ts` を参照してください。

---

### 3. 関数ツール

`tool()` ヘルパーで、**任意**の関数をツールにできます。

<Code
  lang="typescript"
  code={toolsFunctionExample}
  title="Function tool with Zod parameters"
/>

#### オプションリファレンス

| Field                  | Required | Description                                                                                                                                                                                                                                              |
| ---------------------- | -------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `name`                 | No       | デフォルトは関数名（例: `get_weather`）                                                                                                                                                                                                                  |
| `description`          | Yes      | LLM に表示される明確で人間が読める説明                                                                                                                                                                                                                   |
| `parameters`           | Yes      | Zod スキーマまたは元の JSON スキーマオブジェクトのいずれか。Zod の parameters を使うと自動で **strict** モードが有効                                                                                                                                     |
| `strict`               | No       | `true`（デフォルト）の場合、引数が検証に通らないと SDK はモデルエラーを返します。あいまいなマッチングには `false` を指定                                                                                                                                 |
| `execute`              | Yes      | `(args, context, details) => string \| unknown \| Promise<...>` – ビジネスロジック。文字列以外の出力はモデル向けにシリアライズされます。`context` は任意の `RunContext`、`details` には `toolCall`、`resumeState`、`signal` などのメタデータが含まれます |
| `errorFunction`        | No       | 内部エラーをユーザーに見える文字列へ変換するカスタムハンドラー `(context, error) => string`                                                                                                                                                              |
| `timeoutMs`            | No       | 呼び出しごとのタイムアウト（ミリ秒）。0 より大きく `2147483647` 以下である必要                                                                                                                                                                           |
| `timeoutBehavior`      | No       | タイムアウト時の動作: `error_as_result`（デフォルト）はモデル向けのタイムアウトメッセージを返し、`raise_exception` は `ToolTimeoutError` をスロー                                                                                                        |
| `timeoutErrorFunction` | No       | `timeoutBehavior` が `error_as_result` のときにタイムアウト出力をカスタマイズするハンドラー `(context, timeoutError) => string`                                                                                                                          |
| `needsApproval`        | No       | 実行前に人の承認を要求。[人間の介入（HITL）](/openai-agents-js/ja/guides/human-in-the-loop) を参照                                                                                                                                                       |
| `isEnabled`            | No       | 実行ごとに条件付きでツールを公開。真偽値または述語を受け付けます                                                                                                                                                                                         |
| `inputGuardrails`      | No       | ツール実行前に走るガードレール。拒否または例外送出が可能。[ガードレール](/openai-agents-js/ja/guides/guardrails#tool-guardrails) を参照                                                                                                                  |
| `outputGuardrails`     | No       | ツール実行後に走るガードレール。拒否または例外送出が可能。[ガードレール](/openai-agents-js/ja/guides/guardrails#tool-guardrails) を参照                                                                                                                  |

#### 関数ツールのタイムアウト

`timeoutMs` で各関数ツール呼び出しの上限を設定します。

- `timeoutBehavior: 'error_as_result'`（デフォルト）はモデルに `Tool '<name>' timed out after <timeoutMs>ms.` を返す
- `timeoutBehavior: 'raise_exception'` は [`ToolTimeoutError`](/openai-agents-js/openai/agents-core/classes/tooltimeouterror) をスローし、[実行時の例外](/openai-agents-js/ja/guides/running-agents#exceptions) として捕捉可能
- `timeoutErrorFunction` で `error_as_result` モードのタイムアウト文言をカスタマイズ可能
- タイムアウトは `details.signal` を中断するため、長時間実行のツールはキャンセル監視で速やかに停止可能

関数ツールを直接呼び出す場合は、通常のエージェント実行と同じタイムアウト動作を適用するために [`invokeFunctionTool`](/openai-agents-js/openai/agents/functions/invokefunctiontool) を使用してください。

#### 非 strict な JSON スキーマツール

無効または不完全な入力をモデルに推測させたい場合は、元の JSON スキーマ使用時に strict モードを無効化できます:

<Code
  lang="typescript"
  code={nonStrictSchemaTools}
  title="Non-strict JSON schema tools"
/>

---

### 4. Agents as tools

会話を完全に引き継がずに、あるエージェントに別のエージェントを*支援*させたい場合があります。`agent.asTool()` を使います:

<Code lang="typescript" code={agentsAsToolsExample} title="Agents as tools" />

SDK は内部で次を行います:

- 単一の `input` パラメーターを持つ関数ツールを作成
- ツール呼び出し時にその入力でサブエージェントを実行
- 最後のメッセージ、または `customOutputExtractor` で抽出された出力を返却

エージェントをツールとして実行すると、Agents SDK はデフォルト設定で Runner を作成し、関数実行内でそのエージェントを実行します。`runConfig` や `runOptions` のプロパティを指定したい場合は、`asTool()` に渡して Runner の動作をカスタマイズできます。

また、`asTool()` のオプションで `needsApproval` と `isEnabled` を設定し、Human in the loop（人間の介入）フローや条件付きツール公開に統合できます。

`agent.asTool()` の高度な構造化入力オプション:

- `inputBuilder`: 構造化ツール引数を入れ子のエージェント入力ペイロードにマッピング
- `includeInputSchema`: 強力なスキーマ認識動作のために、入れ子の実行に入力 JSON スキーマを含める
- `resumeState`: 入れ子のシリアライズ済み `RunState` を再開する際のコンテキスト再調整戦略を制御

#### エージェントツールからのストリーミングイベント

エージェントツールは、入れ子の実行イベントをすべてアプリにストリームできます。ツールの構築方法に合うフックスタイルを選びます:

<Code
  lang="typescript"
  code={agentsAsToolsStreamingExample}
  title="Streaming agent tools"
/>

- イベント型は `RunStreamEvent['type']` に一致: `raw_model_stream_event`、`run_item_stream_event`、`agent_updated_stream_event`
- `onStream` は最も簡単な「総受け」で、ツールをインライン定義する場合（`tools: [agent.asTool({ onStream })]`）に適しています。イベントごとのルーティングが不要ならこれを使用
- `on(eventName, handler)` は選択的（または `'*'`）に購読可能で、より細かな処理や作成後にリスナーを付与したい場合に最適
- `onStream` またはいずれかの `on(...)` ハンドラーを提供すると、agent‑as‑tool は自動的にストリーミングモードで実行。提供しない場合は非ストリーミング経路のまま
- ハンドラーは並行実行されるため、遅い `onStream` コールバックが `on(...)` ハンドラーをブロックすることはありません（逆も同様）
- `toolCallId` はツールがモデルのツールコールで呼ばれた場合に提供されます。直接の `invoke()` 呼び出しやプロバイダー固有の挙動では省略されることがあります

---

### 5. MCP サーバー

[Model Context Protocol (MCP)](https://modelcontextprotocol.io/) サーバー経由でツールを公開し、エージェントに接続できます。
たとえば、`MCPServerStdio` を使って stdio MCP サーバーを起動・接続できます:

<Code lang="typescript" code={mcpLocalServer} title="Local MCP server" />

完全な例は [`filesystem-example.ts`](https://github.com/openai/openai-agents-js/tree/main/examples/mcp/filesystem-example.ts) を参照してください。MCP サーバーツール統合の包括的なガイドを探している場合は、[MCP 連携](/openai-agents-js/ja/guides/mcp) を参照してください。
複数サーバー（や部分的な失敗）を管理する場合は、`connectMcpServers` と [MCP 連携](/openai-agents-js/ja/guides/mcp#managing-mcp-server-lifecycle) のライフサイクルガイダンスを使用してください。

---

### 6. 実験的: Codex ツール

`@openai/agents-extensions/experimental/codex` は `codexTool()` を提供します。これは、モデルのツールコールを Codex SDK にルーティングし、エージェントがワークスペース単位のタスク（shell、ファイル編集、MCP ツール）を自律的に実行できる関数ツールです。このインターフェースは実験的で変更される可能性があります。

まず依存関係をインストールします:

```bash
npm install @openai/agents-extensions @openai/codex-sdk
```

クイックスタート:

<Code
  lang="typescript"
  code={codexToolExample}
  title="Experimental Codex tool"
/>

知っておくべきこと:

- 認証: `CODEX_API_KEY`（推奨）または `OPENAI_API_KEY` を提供、あるいは `codexOptions.apiKey` を渡す
- 入力: 厳密なスキーマ — `inputs` には少なくとも `{ type: 'text', text }` または `{ type: 'local_image', path }` を 1 つ含める必要
- セーフティ: `sandboxMode` と `workingDirectory` を組み合わせる。ディレクトリが Git リポジトリでない場合は `skipGitRepoCheck` を設定
- スレッディング: `useRunContextThreadId: true` は `runContext.context` にある最新の thread id を読み書きし、アプリ状態でのターン間再利用に有用
- Thread ID の優先順位: ツール呼び出しの `threadId`（スキーマに含めた場合）が最優先、その次がランコンテキストの thread id、その次が `codexTool({ threadId })`
- ランコンテキストキー: `name: 'codex'` の場合はデフォルトで `codexThreadId`。`name: 'engineer'` のような場合は `codexThreadId_<suffix>`（正規化後は `codex_engineer`）
- 変更可能なコンテキストの要件: `useRunContextThreadId` が有効な場合、`run(..., { context })` には変更可能なオブジェクトまたは `Map` を渡す
- 命名: ツール名は `codex` 名前空間に正規化され（`engineer` は `codex_engineer` になる）、同一エージェント内の Codex ツール名の重複は拒否
- ストリーミング: `onStream` は Codex のイベント（reasoning、コマンド実行、MCP ツール呼び出し、ファイル変更、Web 検索）を反映し、進捗のログやトレースが可能
- 出力: ツール結果には `response`、`usage`、`threadId` が含まれ、Codex のトークン使用量は `RunContext` に記録
- 構造: `outputSchema` はディスクリプター、JSON スキーマオブジェクト、または Zod オブジェクトを指定可能。JSON オブジェクトスキーマでは `additionalProperties` は `false` 必須

ランコンテキストのスレッド再利用例:

<Code
  lang="typescript"
  code={codexRunContextThreadExample}
  title="Codex run-context thread reuse"
/>

---

## ツール戦略とベストプラクティス

### ツール使用の挙動

モデルがツールをいつどのように使うべきかの制御は、[エージェント](/openai-agents-js/ja/guides/agents#forcing-tool-use) を参照してください（`modelSettings.toolChoice`、`toolUseBehavior` など）。

---

### ベストプラクティス

- **短く明示的な説明** – ツールが*何を*するか、*いつ使うか*を説明する
- **入力の検証** – 可能であれば Zod スキーマで厳密な JSON 検証を行う
- **エラーハンドラーで副作用を避ける** – `errorFunction` は有用な文字列を返し、例外は投げない
- **ツールは単一責任で** – 小さく合成可能なツールは、より良いモデル推論につながる

---

## 次のステップ

- [ツール使用の強制](/openai-agents-js/ja/guides/agents#forcing-tool-use) について学ぶ
- ツールの入力や出力を検証するために [ガードレール](/openai-agents-js/ja/guides/guardrails) を追加する
- [`tool()`](/openai-agents-js/openai/agents/functions/tool) と各種ホスト型ツールタイプの TypeDoc リファレンスを参照する
