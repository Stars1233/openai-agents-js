---
title: ハンドオフ
description: Delegate tasks from one agent to another
---

import { Code } from '@astrojs/starlight/components';
import basicUsageExample from '../../../../../../examples/docs/handoffs/basicUsage.ts?raw';
import customizeHandoffExample from '../../../../../../examples/docs/handoffs/customizeHandoff.ts?raw';
import handoffInputExample from '../../../../../../examples/docs/handoffs/handoffInput.ts?raw';
import inputFilterExample from '../../../../../../examples/docs/handoffs/inputFilter.ts?raw';
import recommendedPromptExample from '../../../../../../examples/docs/handoffs/recommendedPrompt.ts?raw';

ハンドオフは、会話の一部を別の エージェント に委譲できる機能です。これは、異なる エージェント が特定の分野に特化している場合に有用です。たとえばカスタマーサポートアプリでは、予約、返金、FAQ を担当する エージェント を用意できます。

ハンドオフは LLM に対してツールとして表現されます。`Refund Agent` という エージェント にハンドオフする場合、ツール名は `transfer_to_refund_agent` になります。

## ハンドオフの作成

すべての エージェント は `handoffs` オプションを受け付けます。ここには他の `Agent` インスタンス、または `handoff()` ヘルパーが返す `Handoff` オブジェクトを含められます。

プレーンな `Agent` インスタンスを渡すと、（指定されていれば）その `handoffDescription` が既定のツール説明に追記されます。モデルがそのハンドオフを選ぶべき状況を明確にするために活用してください。

### 基本的な使用方法

<Code lang="typescript" code={basicUsageExample} title="基本的なハンドオフ" />

### `handoff()` によるハンドオフのカスタマイズ

`handoff()` 関数を使うと、生成されるツールを調整できます。

- `agent` – ハンドオフ先の エージェント
- `toolNameOverride` – 既定の `transfer_to_<agent_name>` ツール名を上書き
- `toolDescriptionOverride` – 既定のツール説明を上書き
- `onHandoff` – ハンドオフ発生時のコールバック。`RunContext` と、必要に応じてパース済み入力を受け取る
- `inputType` – ハンドオフに期待する入力スキーマ
- `inputFilter` – 次の エージェント に渡す履歴をフィルター
- `isEnabled` – 一致する実行に対してのみそのハンドオフを公開する boolean または述語

<Code
  lang="typescript"
  code={customizeHandoffExample}
  title="カスタマイズしたハンドオフ"
/>

## ハンドオフの入力

ハンドオフを呼び出す際に LLM にデータ提供をさせたい場合があります。入力スキーマを定義し、`handoff()` で使用します。

<Code lang="typescript" code={handoffInputExample} title="ハンドオフの入力" />

## 入力フィルター

既定ではハンドオフは会話履歴全体を受け取ります。次の エージェント に渡す内容を変更するには、`inputFilter` を指定します。
共通のヘルパーは `@openai/agents-core/extensions` にあります。

<Code lang="typescript" code={inputFilterExample} title="入力フィルター" />

## 推奨プロンプト

プロンプトでハンドオフに言及すると、LLM はより安定して応答します。SDK は `RECOMMENDED_PROMPT_PREFIX` を通じて推奨プレフィックスを提供します。

<Code
  lang="typescript"
  code={recommendedPromptExample}
  title="推奨プロンプト"
/>
