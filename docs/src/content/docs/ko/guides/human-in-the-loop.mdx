---
title: 휴먼 인 더 루프 (HITL)
description: Add a human in the loop check for your agent executions
---

import { Aside, Code } from '@astrojs/starlight/components';
import humanInTheLoopExample from '../../../../../../examples/docs/human-in-the-loop/index.ts?raw';
import toolApprovalDefinition from '../../../../../../examples/docs/human-in-the-loop/toolApprovalDefinition.ts?raw';

이 가이드는 SDK에 내장된 휴먼인더루프(HITL) 지원을 사용하여 인간 개입을 기반으로 에이전트 실행을 일시 중지하고 재개하는 방법을 보여줍니다.

현재 주요 사용 사례는 민감한 도구 실행에 대한 승인을 요청하는 것입니다.

## 승인 요청

`needsApproval` 옵션을 `true` 또는 boolean을 반환하는 async 함수로 설정하여 승인이 필요한 도구를 정의할 수 있습니다.

<Code
  lang="typescript"
  code={toolApprovalDefinition}
  title="도구 승인 정의"
  meta={`{10}`}
/>

### 플로우

1. 에이전트가 도구(들)를 호출하기로 결정하면 `needsApproval`을 평가하여 이 도구가 승인이 필요한지 확인합니다.
2. 승인이 필요한 경우 에이전트는 승인이 이미 승인되었는지 또는 거부되었는지 확인합니다.
   - 승인이 승인 혹은 거부되지 않았다면, 도구 호출을 실행할 수 없다는 정적 메시지를 에이전트에 반환합니다.
   - 승인/거부가 누락된 경우 도구 승인 요청을 트리거합니다.
3. 에이전트는 모든 도구 승인 요청을 수집하고 실행을 인터럽트합니다.
4. 인터럽션이 있는 경우 [실행 결과](/openai-agents-js/ko/guides/results)에 보류 중인 단계를 설명하는 `interruptions` 배열이 포함됩니다. 도구 호출에 확인이 필요한 경우 `type: "tool_approval_item"`을 갖는 `ToolApprovalItem`이 나타납니다.
5. `result.state.approve(interruption)` 또는 `result.state.reject(interruption)`를 호출하여 도구 호출을 승인하거나 거부할 수 있습니다. 동일한 도구를 실행 내내 승인 또는 거부 상태로 유지하려면 `{ alwaysApprove: true }` 또는 `{ alwaysReject: true }`를 전달하세요.
6. 모든 인터럽션을 처리한 후 `runner.run(agent, state)`에 `result.state`를 다시 전달하여 실행을 재개할 수 있습니다. 여기서 `agent`는 전체 실행을 트리거한 원래 에이전트입니다.
7. 플로우는 1단계부터 다시 시작됩니다.

## 예제

아래는 터미널에서 승인을 요청하고 상태를 파일에 임시로 저장하는 휴먼인더루프 플로우의 보다 완전한 예제입니다.

<Code lang="typescript" code={humanInTheLoopExample} title="휴먼인더루프" />

동작하는 엔드 투 엔드 버전은 [전체 예제 스크립트](https://github.com/openai/openai-agents-js/tree/main/examples/agent-patterns/human-in-the-loop.ts)를 참고하세요.

## 긴 승인 대기 시간 처리

휴먼인더루프 플로우는 서버를 계속 실행하지 않고도 오랜 기간 인터럽트 가능하도록 설계되었습니다. 요청을 종료했다가 나중에 계속해야 하는 경우 상태를 직렬화하여 이후에 재개할 수 있습니다.

`result.state.toString()`(또는 `JSON.stringify(result.state)`)을 사용해 상태를 직렬화하고, 직렬화된 상태를 `RunState.fromString(agent, serializedState)`에 전달하여 나중에 재개할 수 있습니다. 여기서 `agent`는 전체 실행을 트리거한 에이전트 인스턴스입니다.

재개된 프로세스가 새로운 컨텍스트 객체를 주입해야 하는 경우에는 `RunState.fromStringWithContext(agent, serializedState, context, { contextStrategy })`를 대신 사용하세요.

- `contextStrategy: 'merge'`(기본값)는 직렬화된 승인 상태를 유지하고 제공된 `RunContext`에 병합합니다.
- `contextStrategy: 'replace'`는 제공된 `RunContext`를 그대로 사용하여 실행을 재구성합니다.

기본적으로 트레이싱 API 키는 직렬화된 상태에서 생략되어 비밀이 실수로 저장되지 않도록 합니다. 상태와 함께 트레이싱 자격 증명을 이동해야 하는 경우에만 `result.state.toString({ includeTracingApiKey: true })`를 전달하세요.

이렇게 하면 직렬화된 상태를 데이터베이스 또는 요청과 함께 저장할 수 있습니다.

### 보류 작업 버전 관리

<Aside>
  이는 주로 에이전트를 변경하는 동안 직렬화된 상태를 오랜 기간 저장하려는 경우에
  적용됩니다.
</Aside>

승인 요청에 시간이 오래 걸리고 에이전트 정의를 의미 있게 버전 관리하거나 Agents SDK 버전을 올릴 계획이라면, 패키지 별칭을 사용하여 두 버전의 Agents SDK를 병행 설치하고 자체 분기 로직을 구현할 것을 권장합니다.

실제로는 코드에 자체 버전 번호를 할당하고 이를 직렬화된 상태와 함께 저장하며, 역직렬화를 코드의 올바른 버전으로 유도하는 것을 의미합니다.
