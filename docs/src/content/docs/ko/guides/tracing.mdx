---
title: 트레이싱
description: Learn how to trace your agent runs
---

import { Aside, Code } from '@astrojs/starlight/components';
import customTraceExample from '../../../../../../examples/docs/custom-trace.ts?raw';
import cloudflareWorkers from '../../../../../../examples/docs/tracing/cloudflareWorkers.ts?raw';

Agents SDK에는 기본 제공 트레이싱이 포함되어 있어 에이전트 실행 중 발생하는 이벤트의 포괄적인 기록을 수집합니다.
LLM 생성, 도구 호출, 핸드오프, 가드레일, 그리고 발생한 사용자 정의 이벤트까지 포함됩니다.  
[Traces 대시보드](https://platform.openai.com/traces)를 사용하면 개발 중과 프로덕션에서 워크플로를 디버그, 시각화, 모니터링할 수 있습니다.

<Aside type="note">

트레이싱은 서버 런타임(Node.js, Deno, Bun)에서 기본적으로 활성화됩니다. 브라우저와 `NODE_ENV=test`일 때는 기본적으로 비활성화됩니다.

서버 환경에서 트레이싱을 비활성화하는 방법은 두 가지입니다.

1. 환경 변수 `OPENAI_AGENTS_DISABLE_TRACING=1`을 설정해 전역으로 트레이싱을 비활성화할 수 있습니다
2. `new Runner(...)`에서 [`RunConfig.tracingDisabled`](/openai-agents-js/openai/agents-core/type-aliases/runconfig/#tracingdisabled)를 `true`로 설정해 runner 단위로 비활성화할 수 있습니다

**_OpenAI API를 사용하면서 Zero Data Retention (ZDR) 정책을 운영하는 조직에서는 트레이싱을 사용할 수 없습니다._**

</Aside>

## 내보내기 루프 수명 주기

지원되는 서버 런타임에서는 trace가 일정 주기로 내보내집니다.  
Cloudflare Workers를 포함한 일부 런타임에서는 트레이싱 자체는 활성화되어 있어도 자동 내보내기 루프를 사용할 수 없습니다. 이러한 환경에서는 런타임이 종료되기 전에 대기 중인 trace를 내보내기 위해 요청 수명 주기의 일부로 `getGlobalTraceProvider().forceFlush()`를 호출해야 합니다.

브라우저에서는 기본적으로 트레이싱이 비활성화되어 있으므로 이 지침은 적용되지 않습니다.

예를 들어 Cloudflare Worker에서는 코드를 `try/catch/finally` 블록으로 감싸고 `waitUntil`과 함께 `forceFlush()`를 사용해 worker가 종료되기 전에 trace가 내보내지도록 해야 합니다.

<Code
  lang="typescript"
  code={cloudflareWorkers.replace(/\s+\/\/ @ts-expect-error.*$/m, '')}
  meta="{13}"
/>

## Traces 및 spans

- **Traces**는 하나의 "워크플로"에 대한 단일 end-to-end 작업을 나타냅니다. Trace는 Span으로 구성됩니다. Trace에는 다음 속성이 있습니다
  - `workflow_name`: 논리적 워크플로 또는 앱입니다. 예: "Code generation", "Customer service"
  - `trace_id`: trace의 고유 ID입니다. 전달하지 않으면 자동 생성됩니다. 형식은 `trace_<32_alphanumeric>`이어야 합니다
  - `group_id`: 선택적 그룹 ID로, 같은 대화에서 여러 trace를 연결할 때 사용합니다. 예를 들어 채팅 스레드 ID를 사용할 수 있습니다
  - `disabled`: True이면 trace는 기록되지 않습니다
  - `metadata`: trace용 선택적 메타데이터입니다
- **Spans**는 시작 시각과 종료 시각이 있는 작업을 나타냅니다. Span에는 다음이 있습니다
  - `started_at` 및 `ended_at` 타임스탬프
  - 소속 trace를 나타내는 `trace_id`
  - 이 Span의 상위 Span을 가리키는 `parent_id`(있는 경우)
  - Span에 대한 정보인 `span_data`. 예를 들어 `AgentSpanData`에는 Agent 정보, `GenerationSpanData`에는 LLM 생성 정보가 포함됩니다

## 기본 트레이싱

기본적으로 SDK는 다음을 트레이싱합니다.

- 전체 `run()` 또는 `Runner.run()`이 `Trace`로 감싸집니다
- 에이전트가 실행될 때마다 `AgentSpan`으로 감싸집니다
- LLM 생성은 `GenerationSpan`으로 감싸집니다
- 함수 도구 호출 각각은 `FunctionSpan`으로 감싸집니다
- 가드레일은 `GuardrailSpan`으로 감싸집니다
- 핸드오프는 `HandoffSpan`으로 감싸집니다

기본적으로 trace 이름은 "Agent workflow"입니다. `withTrace`를 사용할 때 이 이름을 설정할 수 있으며, [`RunConfig.workflowName`](/openai-agents-js/openai/agents-core/type-aliases/runconfig/#workflowname)으로 이름과 다른 속성도 설정할 수 있습니다.

또한 [사용자 정의 트레이싱 프로세서](#custom-tracing-processors)를 설정해 trace를 다른 대상(대체 또는 보조 대상)으로 전송할 수 있습니다.

### 음성 에이전트 트레이싱

`RealtimeAgent`와 `RealtimeSession`을 기본 OpenAI Realtime API와 함께 사용하는 경우, `tracingDisabled: true`를 `RealtimeSession`에 설정하거나 `OPENAI_AGENTS_DISABLE_TRACING` 환경 변수를 사용해 비활성화하지 않는 한 Realtime API 측에서 자동으로 트레이싱이 수행됩니다.

자세한 내용은 [음성 에이전트 개요](/openai-agents-js/ko/guides/voice-agents)를 확인하세요.

## 상위 수준 traces

경우에 따라 여러 번의 `run()` 호출을 하나의 trace에 포함하고 싶을 수 있습니다. 이 경우 전체 코드를 `withTrace()`로 감싸면 됩니다.

<Code lang="typescript" code={customTraceExample} />

1. 두 번의 `run` 호출이 `withTrace()`로 감싸져 있으므로, 각각의 실행은 개별 trace 두 개를 만드는 대신 전체 trace의 일부가 됩니다

## traces 생성

[`withTrace()`](/openai-agents-js/openai/agents-core/functions/withtrace/) 함수를 사용해 trace를 생성할 수 있습니다. 또는 `getGlobalTraceProvider().createTrace()`를 사용해 새 trace를 수동으로 만들고 `withTrace()`에 전달할 수 있습니다.

현재 trace는 [Node.js `AsyncLocalStorage`](https://nodejs.org/api/async_context.html#class-asynclocalstorage) 또는 각 환경의 polyfill을 통해 추적됩니다. 즉, 동시성 환경에서도 자동으로 동작합니다.

## spans 생성

다양한 `create*Span()`(예: `createGenerationSpan()`, `createFunctionSpan()` 등) 메서드를 사용해 span을 생성할 수 있습니다. 일반적으로 span을 수동으로 생성할 필요는 없습니다. 사용자 정의 span 정보를 추적하기 위한 [`createCustomSpan()`](/openai-agents-js/openai/agents-core/functions/createcustomspan/) 함수도 제공됩니다.

Span은 자동으로 현재 trace에 포함되며, 가장 가까운 현재 span 아래에 중첩됩니다. 이는 [Node.js `AsyncLocalStorage`](https://nodejs.org/api/async_context.html#class-asynclocalstorage) 또는 각 환경의 polyfill을 통해 추적됩니다.

## 민감한 데이터

일부 span은 잠재적으로 민감한 데이터를 수집할 수 있습니다.

`createGenerationSpan()`은 LLM 생성의 입력/출력을 저장하고,  
`createFunctionSpan()`은 함수 호출의 입력/출력을 저장합니다. 이 데이터에는 민감한 정보가 포함될 수 있으므로,  
[`RunConfig.traceIncludeSensitiveData`](/openai-agents-js/openai/agents-core/type-aliases/runconfig/#traceincludesensitivedata)를 통해 해당 데이터 수집을 비활성화할 수 있습니다.

## OpenAI 트레이싱 내보내기 도구

지원되는 서버 런타임에서는 기본 트레이싱 설정이 이미 OpenAI로 내보내기를 수행합니다. trace 내보내기에
`OPENAI_API_KEY`와 다른 자격 증명을 사용해야 한다면 `setTracingExportApiKey()`를 사용하세요.

사용자 정의 수집 동작이 필요하다면
[`OpenAITracingExporter`](/openai-agents-js/openai/agents-openai/classes/openaitracingexporter)를 직접 인스턴스화하고 `setTraceProcessors(...)` 또는 `addTraceProcessor(...)`로 설치하세요. 이 exporter는
`apiKey`, `endpoint`, `organization`, `project`, `maxRetries`, `baseDelay`,
`maxDelay`를 지원합니다.

기본 프로세서를 교체한 뒤 나중에 배치 프로세서와 함께 기본 OpenAI exporter를 복원하려면,
[`setDefaultOpenAITracingExporter()`](/openai-agents-js/openai/agents-openai/functions/setdefaultopenaitracingexporter/)를 호출하세요.

## 사용자 정의 트레이싱 프로세서

트레이싱의 상위 수준 아키텍처는 다음과 같습니다.

- 초기화 시 전역 [`TraceProvider`](/openai-agents-js/openai/agents-core/classes/traceprovider)를 생성하며, 이는 trace 생성을 담당하고 [`getGlobalTraceProvider()`](/openai-agents-js/openai/agents-core/functions/getglobaltraceprovider/)를 통해 접근할 수 있습니다
- `TraceProvider`를 [`BatchTraceProcessor`](/openai-agents-js/openai/agents-core/classes/batchtraceprocessor/)로 구성하며, 이는 trace/span을 배치로 [`OpenAITracingExporter`](/openai-agents-js/openai/agents-openai/classes/openaitracingexporter/)에 전송하고, exporter는 span과 trace를 배치로 OpenAI 백엔드에 내보냅니다

이 기본 설정을 사용자 정의해 trace를 대체 또는 추가 백엔드로 전송하거나 exporter 동작을 변경하려면 두 가지 옵션이 있습니다.

1. [`addTraceProcessor()`](/openai-agents-js/openai/agents-core/functions/addtraceprocessor)를 사용하면 준비된 trace와 span을 받는 **추가** 트레이싱 프로세서를 추가할 수 있습니다. 이를 통해 OpenAI 백엔드로 전송하는 것에 더해 자체 처리를 수행할 수 있습니다
2. [`setTraceProcessors()`](/openai-agents-js/openai/agents-core/functions/settraceprocessors)를 사용하면 기본 프로세서를 자체 트레이싱 프로세서로 **교체**할 수 있습니다. 이 경우 trace를 OpenAI 백엔드로 전송하는 `TracingProcessor`를 포함하지 않으면 trace는 전송되지 않습니다

## 외부 트레이싱 프로세서 목록

- [AgentOps](https://docs.agentops.ai/v2/usage/typescript-sdk#openai-agents-integration)
- [Keywords AI](https://docs.keywordsai.co/integration/development-frameworks/openai-agents-sdk-js)
